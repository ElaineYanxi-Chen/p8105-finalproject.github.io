---
title: "Statistical Analysis of Abortion Trends Among NYC and Compared to NY State"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, message=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r data, message=FALSE, include=FALSE}
abortion_data = read_csv("data/abortion_data.csv")
abortion_race = read_csv("data/abortion_race.csv")
abortion_finance = read_csv("data/abortion_finance.csv")
```

## Abortions Rates Comparing NYC and NY State

### *Proportion T-test*

**Do overall abortion rates differ between NYC and NY state?**

**$H_0$**: The number of abortions per 1000 births is the same between NYC and NY state.

**$H_1$**: The number of abortions per 1000 births differs between NYC and NY state.

```{r tidy_totals}
# Tidy data
abortion_totals =
  abortion_data %>%
  select(borough, total) %>%
  head(2) %>%
  mutate(
    n = total,
    total = 1000)

abortion_totals %>% 
  select (-total) %>%
  knitr::kable(caption = "Proportion T-Test Results for NYC and NYS", col.names = c("Region", "Abortions per 1000 births"), align = c('l', 'c'), format = "simple")
```

```{r prop}
# Run prop t-test
prop.test(abortion_totals$n, abortion_totals$total,
          p = NULL, alternative = "two.sided")
```

**Inference:**

- From the above results, the p-value is **less than the 5% level of significance.** Therefore, we **reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the number of abortions per 1000 births differs between NYC and NY state.

## Abortion Trends in NYC

### *Proportion T-Test*

**Do overall abortion rates differ across boroughs?**

**$H_0$**: The number of abortions per 1000 births is the same across all boroughs.

**$H_1$**: The number of abortions per 1000 births is not the same across all boroughs.

```{r tidy_borough}
# Tidy data
abortion_totals_borough =
  abortion_data %>%
  select(borough, total) %>%
  slice(3:7) %>%
  mutate(
    n = total,
    total = 1000)

abortion_totals_borough %>%
  select (-total) %>%
  knitr::kable(caption = "Proprotion T-Test Results for NYC across all Boroughs", col.names = c("Borough", "Abortions per 1000 births"), align = c('l', 'c'), format = "simple")
```

```{r prop_boroughs}
# Run 5 prop t-test
prop.test(abortion_totals_borough$n, abortion_totals_borough$total,
          p = NULL, alternative = "two.sided")
```

**Infecrence:**

- From the above results, the p-value is **less than the 5% level of significance**. Therefore, we **reject the null hypothesis**. 

- The data provides sufficient evidence to support the hypothesis that the number of abortions per 1000 births differs across boroughs.

### *Chi Square Test - Race and Boroughs*

**Do overall abortion rates differ across boroughs by race?**

**$H_0$**: The expected counts of abortions in each race category are the same across all boroughs.

**$H_1$**: The expected counts of abortions in each race category are not the same across all boroughs.

```{r tidy_race}
# Tidy data
abortion_race_clean = 
  abortion_race %>%
  slice(3:7) %>%
  mutate(
    hispanic = hispanic_ratio*1000,
    h_white_only = h_white_only_ratio*1000,
    h_black_only = h_black_only_ratio*1000,
    non_hispanic = non_hispanic_ratio*1000,
    nh_white_only = nh_white_only_ratio*1000,
    nh_black_only = nh_black_only_ratio*1000,
    nh_other = nh_other_ratio*1000
  ) %>%
  select(-(hispanic_ratio:nh_other_ratio)) %>% select(-total)

abortion_race_clean %>% 
  knitr::kable(caption = "Chi-Square Test Results for Race and Boroughs", col.names = c("Borough", "Hispanic", "Hispanic White", "Hispanic Black", "Non-Hispanic", "Non-Hispanic White", "Non-Hispanic Black", "Non-Hispanic Other"), align = c('l', 'c', 'c', 'c', 'c','c','c','c'), format = "simple")
```

```{r chi-sq_race}
abortion_race_clean =
  abortion_race_clean %>%
  select(-borough)

# Run chi-square test
chisq.test(abortion_race_clean)
```

```{r x_crit_race}
x_crit = qchisq(0.95, 24)
x_crit
```

**Inference:** 

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, we **reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the number of abortions in each race category across boroughs is different. 

### *Chi Square Test - Finance Plan and Boroughs*

**Do overall abortion rates differ across boroughs by finance plan?**

**$H_0$**: The expected counts of abortions in each finance plan category are the same across all boroughs.

**$H_1$**: The expected counts of abortions in each finance plan category are not the same across all boroughs.

```{r}
# Tidy data
abortion_finance_clean = 
  abortion_finance %>%
  slice(3:7) %>%
  mutate(
    medicaid = medicaid*1000,
    self_pay = self_pay*1000,
    other_insurance = other_insurance*1000,
    not_stated = not_stated*1000
  ) %>%
  select(-total)

abortion_finance_clean %>% 
  knitr::kable(caption = "Results Table", col.names = c("Borough", "Medicaid", "Self-Pay", "Other Insurance", "Not Stated"), align = c('l', 'c', 'c', 'c', 'c'), format = "simple" )
```

```{r}
abortion_finance_clean =
  abortion_finance_clean %>%
  select(-borough)

# Run chi-square test
chisq.test(abortion_finance_clean)
```

```{r}
x_crit = qchisq(0.95, 12)
x_crit
```

**Inference:**

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, **we reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the number of abortions in each finance category across borough is different.

