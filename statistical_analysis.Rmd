---
title: "Statistical Analysis of Abortion Trends Among NYC and Compared to NY State"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
---

```{r setup, message=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r data, message=FALSE, include=FALSE}
abortion_data = read_csv("data/master.csv")
```

## Abortion Trends in NYC

### *Proportion T-Test*

**Do overall abortion rates differ across boroughs?**

**$H_0$**: The number of abortions per 1000 live births is the same across all boroughs.

**$H_1$**: The number of abortions per 1000 live births is not the same across all boroughs.

```{r tidy_borough}
# Tidy data
abortion_totals_borough =
  abortion_data %>%
  select(borough, total) %>%
  slice(1:5) %>%
  mutate(
    n = total,
    total = 1000)

abortion_totals_borough %>%
  select (-total) %>%
  knitr::kable(caption = "Proportion T-Test for NYC across all Boroughs", col.names = c("Borough", "Abortions per 1000 live births"), align = c('l', 'c'), format = "simple")
```

```{r prop_boroughs}
# Run 5 prop t-test
prop.test(abortion_totals_borough$n, abortion_totals_borough$total,
          p = NULL, alternative = "two.sided")
```

**Inference:**

- From the above results, the p-value is **less than the 5% level of significance**. Therefore, we **reject the null hypothesis**. 

- The data provides sufficient evidence to support the hypothesis that overall abortion rates differs across boroughs.

### *Chi Square Test - Race and Boroughs*

**Do overall abortion rates differ across boroughs by race?**

**$H_0$**: The expected counts of abortions in each race category are the same across all boroughs.

**$H_1$**: The expected counts of abortions in each race category are not the same across all boroughs.

```{r tidy_race}
# Tidy data
abortion_race_clean = 
  abortion_data %>%
  slice(1:5) %>%
  mutate(
    hispanic = h_total*1000,
    nh_white_only = nh_white_only_ratio*1000,
    nh_black_only = nh_black_only_ratio*1000,
    nh_other = nh_other_ratio*1000
  ) %>%
  select(-(age_less_20:total))

abortion_race_clean %>% 
  knitr::kable(caption = "Chi-Square Test for Race and Boroughs", col.names = c("Borough", "Hispanic", "Non-Hispanic White", "Non-Hispanic Black", "Non-Hispanic Other"), align = c('l', 'c', 'c', 'c', 'c'), format = "simple")
```

```{r chi-sq_race}
abortion_race_clean =
  abortion_race_clean %>%
  select(-borough)

# Run chi-square test
chisq.test(abortion_race_clean)
```

```{r x_crit_race}
x_crit = qchisq(0.95, 12)
x_crit
```

**Inference:** 

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, we **reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the number of abortions in each race category across boroughs is different. 

### *Chi Square Test - Finance Plan and Boroughs*

**Do overall abortion rates differ across boroughs by finance plan?**

**$H_0$**: The expected counts of abortions in each finance plan category are the same across all boroughs.

**$H_1$**: The expected counts of abortions in each finance plan category are not the same across all boroughs.

```{r tidy_finance}
# Tidy data
abortion_finance_clean = 
  abortion_data %>%
  slice(1:5) %>%
  mutate(
    medicaid = medicaid*1000,
    self_pay = self_pay*1000,
    other_insurance = other_insurance*1000,
    not_stated = not_stated*1000
  ) %>%
  select(-(age_less_20:h_black_only_ratio)) %>% select(-total)

abortion_finance_clean %>% 
  knitr::kable(caption = "Chi-Square Test for Finance Plan and Boroughs", col.names = c("Borough", "Medicaid", "Self-Pay", "Other Insurance", "Not Stated"), align = c('l', 'c', 'c', 'c', 'c'), format = "simple" )
```

```{r chi-squ_finance}
abortion_finance_clean =
  abortion_finance_clean %>%
  select(-borough)

# Run chi-square test
chisq.test(abortion_finance_clean)
```

```{r x_crit_finance}
x_crit = qchisq(0.95, 12)
x_crit
```

**Inference:**

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, **we reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the number of abortions in each finance category across borough is different.

### *Chi Square Test - Age and Boroughs*

**Do overall abortion rates differ across boroughs by age?**

**$H_0$**: The expected counts of abortions in each age category are the same across all boroughs.

**$H_1$**: The expected counts of abortions in each age category are not the same across all boroughs.

```{r tidy_age}
# Tidy data
abortion_age_clean = 
  abortion_data %>%
  slice(1:5) %>%
  mutate(
    age_less_20 = age_less_20*1000,
    age_20_24 = age_20_24*1000,
    age_25_29 = age_25_29*1000,
    age_30_34 = age_30_34*1000,
    age_35_39 = age_35_39*1000,
    age_plus_40 = age_plus_40*1000
  ) %>%
  select(-(nh_total:total))

abortion_age_clean %>% 
  knitr::kable(caption = "Chi-Square Test for Age and Boroughs", col.names = c("Borough", "< 20 years", "20-24 years", "25-29 years", "30-34 years", "35-39 years", "40+ years"), align = c('l', 'c', 'c', 'c', 'c', 'c', 'c'), format = "simple" )
```

```{r chi-sq_age}
abortion_age_clean =
  abortion_age_clean %>%
  select(-borough)

# Run chi-square test
chisq.test(abortion_age_clean)
```

```{r x_crit_age}
x_crit = qchisq(0.95, 5)
x_crit
```

**Inference:**

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, **we reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the overall abortion rate in each age category across borough is different.

## *Abortion Trends in NY State*

### *Proportion Test*

**Do overall abortion rates differ across NY state regions?**

**$H_0$**: The number of abortions per 1000 live births is the same across all NY state regions.

**$H_1$**: The number of abortions per 1000 live births is not the same across all NY state regions.

```{r data_NY, message=FALSE, include=FALSE}
NY_year = read_csv("data/NY_year.csv")
```

```{r tidy_NY}
# Tidy data
NY_totals =
  NY_year %>%
  select(borough, total) %>%
  slice(1:10) %>%
  mutate(
    n = total,
    total = 1000)

NY_totals %>% 
  select(-total) %>%
  knitr::kable(caption = "Proportion T-Test for NY across all Regions",
  col.names = c("Region", "Abortions per 1000 live births"), align = c('l', 'c'), format = "simple")
```

```{r prop_NY}
# Run 10 prop t-test
prop.test(NY_totals$n, NY_totals$total,
          p = NULL, alternative = "two.sided")
```

**Inference:**

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, **we reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that overall abortion rates differs across NY state regions.

### *Chi Square Test - Race and NY State Regions*

**Do overall abortion rates differ across NY state regions by race?**

**$H_0$**: The expected counts of abortions in each race category are the same across all NY state regions.

**$H_1$**: The expected counts of abortions in each race category are not the same across all NY state regions.

```{r NY_tidy_race}
# Tidy data
NY_race_clean = 
  abortion_data %>%
  select(-(age_less_20:nh_total)) %>% select(-(h_white_only_ratio:total)) %>%
  drop_na() %>%
  mutate(
    hispanic = h_total*1000,
    nh_white_only = nh_white_only_ratio*1000,
    nh_black_only = nh_black_only_ratio*1000,
    nh_other = nh_other_ratio*1000
  ) %>%
  select(-(nh_white_only_ratio:h_total)) %>%
  relocate(region, .before = borough)

NY_race_clean %>% 
  knitr::kable(caption = "Chi-Square Test for Race and Regions", col.names = c("Region", "Borough/County", "Hispanic", "Non-Hispanic White", "Non-Hispanic Black", "Non-Hispanic Other"), align = c('l', 'c', 'c', 'c', 'c','c','c'), format = "simple")
```

```{r NY_chi-sq_race}
NY_race_clean =
  NY_race_clean %>%
  select(-(region:borough))

# Run chi-square test
chisq.test(NY_race_clean)
```

```{r NY_x_crit_race}
x_crit = qchisq(0.95, 5)
x_crit
```

### *Chi Square Test - Finance Plans and NY State Regions*

**Do overall abortion rates differ across NY state regions by finance plan?**

**$H_0$**: The expected counts of abortions in each finance plan category are the same across all NY state regions.

**$H_1$**: The expected counts of abortions in each finance plan category are not the same across all NY state regions.

```{r NY_tidy_finance}
# Tidy data
NY_finance_clean = 
  NY_finance %>%
  slice(3:7) %>%
  mutate(
    medicaid = medicaid*1000,
    self_pay = self_pay*1000,
    other_insurance = other_insurance*1000,
    not_stated = not_stated*1000
  ) %>%
  select(-total)

NY_finance_clean %>% 
  knitr::kable(caption = "Chi-Square Test Finance Plan and Regions", col.names = c("Region", "Medicaid", "Self-Pay", "Other Insurance", "Not Stated"), align = c('l', 'c', 'c', 'c', 'c'), format = "simple" )
```

```{r NY_chi-sq_finance}
NY_finance_clean =
  NY_finance_clean %>%
  select(-borough)

# Run chi-square test
chisq.test(NY_finance_clean)
```

```{r NY_x_crit_finance}
x_crit = qchisq(0.95, 12)
x_crit
```

**Inference:**

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, **we reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that overall abortion rates in each finance category across regions is different.

### *Chi Square Test - Age and NY State Regions*

**Do overall abortion rates differ across NY state regions by age?**

**$H_0$**: The expected counts of abortions in each age category are the same across all NY state regions.

**$H_1$**: The expected counts of abortions in each age category are not the same across all NY state regions.

```{r NY_tidy_age}
# Tidy data
NY_age_clean = 
  NY_age %>%
  slice(3:7) %>%
  mutate(
    age_less_20 = age_less_20*1000,
    age_20_24 = age_20_24*1000,
    age_25_29 = age_25_29*1000,
    age_30_34 = age_30_34*1000,
    age_35_39 = age_35_39*1000,
    age_plus_40 = age_plus_40*1000
  ) %>%
  select(-total)

NY_age_clean %>% 
  knitr::kable(caption = "Chi-Square Test for Age and Regions", col.names = c("Regions", "< 20 years", "20-24 years", "25-29 years", "30-34 years", "35-39 years", "40+ years"), align = c('l', 'c', 'c', 'c', 'c', 'c', 'c'), format = "simple" )
```

```{r NY_chi-sq_age}
NY_age_clean =
  NY_age_clean %>%
  select(-borough) %>%
  drop_na()

# Run chi-square test
chisq.test(NY_age_clean)
```

```{r NY_x_crit_age}
x_crit = qchisq(0.95, 5)
x_crit
```

**Inference:**

- From the above results, **$X^2$ is greater than the test-statistic at the 5% level of significance**. Therefore, **we reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that overall abortion rates in each age category across regions is different.

## Abortions Rates Comparing NYC and NY State

### *Proportion T-test*

**Do overall abortion rates differ between NYC and NY state?**

**$H_0$**: The number of abortions per 1000 births is the same between NYC and NY state.

**$H_1$**: The number of abortions per 1000 births differs between NYC and NY state.

```{r tidy_totals}
# Tidy data
abortion_totals =
  abortion_data %>%
  select(borough, total) %>%
  head(2) %>%
  mutate(
    n = total,
    total = 1000)

abortion_totals %>% 
  select (-total) %>%
  knitr::kable(caption = "Proportion T-Test Results for NYC and NYS", col.names = c("Region", "Abortions per 1000 births"), align = c('l', 'c'), format = "simple")
```

```{r prop}
# Run prop t-test
prop.test(abortion_totals$n, abortion_totals$total,
          p = NULL, alternative = "two.sided")
```

**Inference:**

- From the above results, the p-value is **less than the 5% level of significance.** Therefore, we **reject the null hypothesis.** 

- The data provides sufficient evidence to support the hypothesis that the number of abortions per 1000 births differs between NYC and NY state.


