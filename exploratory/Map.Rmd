---
title: "Map"
date: "2022-12-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggridges)
library(patchwork)
library(readxl)
library(rvest)
library(httr)
library(dplyr)
library(leaflet)

library(tigris)
library(sp)
library(ggmap)
library(maptools)
library(broom)
library(rgdal)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

## Exploratory Analysis

Get the data

#```{r data_import}
abortion_final = read_csv(file = "data/abortion_data.csv") %>%
    janitor::clean_names()
```

#```{r}
leaflet() %>%
  addTiles() %>%
  setView(-74.00, 40.71, zoom = 10) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addMarkers(lat = 40.71, lng = -74, popup = "Manhattan") %>%
  addMarkers(lat = 40.83, lng = -73.87, popup = "Bronx") %>%
  addMarkers(lat = 40.73, lng = -73.79, popup = "Queen") %>%
  addMarkers(lat = 40.58, lng = -74.15, popup = "Staten Island") %>%
  addMarkers(lat = 40.68, lng = -73.94, popup = "Brooklyn")

nyc_tracts <- county_subdivisions(state = '36', county = c('061','047','081','005','085'))

summary(nyc_tracts)
plot(nyc_tracts)

```


## `Plotly`

Trying out the built-in state geometries within the `plotly` package.


```{r}
library(tidyverse)
library(plotly)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r}
abortion_final = read_csv(file = "data/abortion_data.csv") %>%
    janitor::clean_names()
```

```{r}
l = list(colour = toRGB("white"), width = 2)

g = list(scope = "usa")

test = abortion_final %>% 
  select(borough, total) %>% 
  plot_geo(locationmode = "USA-states", locations = "NY") %>%
  add_trace(
    z = ~total, locations = ~borough,
    color = ~total, colors = "viridis"
  ) %>% 
  colorbar(title = "") %>% 
  layout(geo = g)
```


Couldn't get display of state-only level data. Trying out the `tidycensus` package next...

## `tidycensus`

Working with non-census data...

```{r}
library(tigris)
```

```{r}
ny_counties = 
  counties(state = "36", cb = TRUE, resolution = "20m") 

write_csv(ny_counties, file = "data/ny_counties_geo.csv")

```

<<<<<<< HEAD
This method seems promising, using methods described in the `tidycensus` [website](https://walker-data.com/census-r/mapping-census-data-with-r.html#cartographic-workflows-with-non-census-data), chapter 6.4. Will wait for a merged dataset with geographic and abortion information to try make an interactive map.


```{r}
merged_data = read_csv("data/master.csv")
```

=======
```{r}
NY_counties = 
  read_csv(file = "data/ny_counties_geo.csv") %>%
  janitor::clean_names()

NY_abortion = 
  read_csv(file = "data/master.csv") %>%
  janitor::clean_names() %>%
  transform(borough = gsub(pattern = "Brooklyn", replacement = "Kings", borough)) %>%
  transform(borough = gsub(pattern = "Manhattan", replacement = "New York", borough)) %>%
  transform(borough = gsub(pattern = "Staten Island", replacement = "Richmond", borough)) %>%
  transform(borough = gsub(pattern = "Essex/Hamilton", replacement = "Essex", borough)) %>%
  transform(borough = gsub(pattern = "St Lawrence", replacement = "St. Lawrence", borough)) %>%
  rename(name = borough)

NY_total = full_join(NY_counties, NY_abortion, by = "name")

```


This method seems promising, using methods described in the `tidycensus` [website](https://walker-data.com/census-r/mapping-census-data-with-r.html#cartographic-workflows-with-non-census-data), chapter 6.4. Will wait for a merged dataset with geographic and abortion information to try make an interactive map.
>>>>>>> 710d2937761582c0640023e5c1f0af346b1af8cf
